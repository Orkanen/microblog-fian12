---
# IF DATASOURCE IS PRESENT basicAuthPassword ERROR
- name: create prometheus datasource
  community.grafana.grafana_datasource:
    name: Prometheus
    url: "http://{{ groups.monitoring[0] }}:3000"
    ds_type: prometheus
    ds_url: "http://{{ groups.monitoring[0] }}:9090"
    access: proxy
    tls_skip_verify: true
    additional_json_data:
      httpHeaderName1: "Authorization"
    additional_secure_json_data:
      httpHeaderValue1: "Bearer ihavenogroot"
      grafana_user: "admin"
      grafana_password: "admin"
  ignore_errors: yes

- name: Copy nginx dashboard
  copy:
    src: nginx.json
    dest: /tmp/nginx.json

- name: Copy flask dashboard
  copy:
    src: flask.json
    dest: /tmp/flask.json

- name: Add Node exporter full dashboard
  community.grafana.grafana_dashboard:
    grafana_url: "http://{{ groups.monitoring[0] }}:3000"
    grafana_user: "admin"
    grafana_password: "admin"
    dashboard_id: 1860
    dashboard_revision: 22
  ignore_errors: yes

- name: Add Nginx dashboard
  community.grafana.grafana_dashboard:
    grafana_url: "http://{{ groups.monitoring[0] }}:3000"
    grafana_user: "admin"
    grafana_password: "admin"
    state: present
    overwrite: true
    path: /tmp/nginx.json

- name: Add Flask dashboard
  community.grafana.grafana_dashboard:
    grafana_url: "http://{{ groups.monitoring[0] }}:3000"
    grafana_user: "admin"
    grafana_password: "admin"
    state: present
    overwrite: true
    path: /tmp/nginx.json